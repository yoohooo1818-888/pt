<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
<title>倒水红包版</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; touch-action:manipulation; -webkit-tap-highlight-color:transparent; user-select:none; }
body { 
  width:100%; min-height:100vh;
  background: radial-gradient(ellipse at center, #1a2b4a 0%, #0a1628 100%);
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
  position:relative; overflow:hidden;
}

/* 红包 - 顶部 */
.red-packets-container { 
  position:absolute; top:60px; left:0; right:0; 
  display:flex; justify-content:center; gap:40px; z-index:10;
}
.red-packet { 
  width:60px; height:75px; 
  background:url('红包.png') center/contain no-repeat;
  filter:drop-shadow(0 4px 8px rgba(0,0,0,0.3));
  animation:glow 2s infinite;
}
@keyframes glow { 0%,100%{transform:scale(1);} 50%{transform:scale(1.05);} }

/* 瓶子区域 - 固定在中间偏下 */
.bottles-container {
  position:absolute; 
  top:50%; left:0; right:0;
  display:flex; justify-content:center; align-items:flex-end; gap:10px;
  height:200px; z-index:20;
  padding:0 20px;
}
.bottle-wrapper { 
  position:relative; width:60px; height:120px; cursor:pointer;
  transition:transform 0.2s;
  background:rgba(255,255,255,0.1); /* 辅助底色，能看到位置 */
  border:2px solid rgba(255,255,255,0.3);
  border-radius:10px;
}
.bottle-wrapper.selected { transform:scale(1.1); border-color:#FFD700; background:rgba(255,215,0,0.2); }
.bottle-body {
  position:absolute; bottom:0; width:100%; height:100%;
  background:url('玻璃瓶.png') center bottom/contain no-repeat;
  z-index:10;
}
.liquid-container {
  position:absolute; bottom:5px; left:10px; right:10px; height:90px;
  display:flex; flex-direction:column-reverse; z-index:5;
}
.liquid-layer { width:100%; height:25%; transition:all 0.3s; }
.cork {
  position:absolute; top:-8px; left:50%; transform:translateX(-50%);
  width:40px; height:35px;
  background:url('软木塞.png') center/contain no-repeat;
  z-index:20; opacity:0; transition:0.3s;
}
.bottle-wrapper.corked .cork { opacity:1; }

/* 提示 */
.hint-box {
  position:absolute; top:180px; left:50%; transform:translateX(-50%);
  background:rgba(0,0,0,0.7); color:#fff;
  padding:10px 15px; border-radius:20px; font-size:14px;
  z-index:50; text-align:center;
}
</style>
</head>
<body>
<div class="red-packets-container" id="redPackets"></div>
<div class="bottles-container" id="bottles"></div>
<div class="hint-box" id="hint">点击瓶子开始游戏</div>

<script>
const COLORS = [
  { name:'red', hex:'#FF4757' },
  { name:'blue', hex:'#3742FA' },
  { name:'green', hex:'#2ED573' }
];

let bottles = [], selectedIndex = null;

function init() {
  // 创建红包
  const packetContainer = document.getElementById('redPackets');
  COLORS.forEach(c => {
    const p = document.createElement('div');
    p.className = 'red-packet';
    p.id = 'packet-'+c.name;
    packetContainer.appendChild(p);
  });
  
  // 创建4个瓶子（确保在屏幕内）
  const container = document.getElementById('bottles');
  const initColors = [
    [COLORS[0], COLORS[1]], // 瓶子1: 红蓝
    [COLORS[1], COLORS[2]], // 瓶子2: 蓝绿
    [COLORS[2], COLORS[0]], // 瓶子3: 绿红
    [] // 瓶子4: 空
  ];
  
  for(let i=0; i<4; i++) {
    const wrapper = document.createElement('div');
    wrapper.className = 'bottle-wrapper';
    wrapper.dataset.index = i;
    wrapper.innerHTML = `
      <div class="bottle-body"></div>
      <div class="liquid-container" id="liquid-${i}"></div>
      <div class="cork"></div>
    `;
    
    // 添加液体
    const liquid = wrapper.querySelector(`#liquid-${i}`);
    initColors[i].forEach(color => {
      const layer = document.createElement('div');
      layer.className = 'liquid-layer';
      layer.style.backgroundColor = color.hex;
      liquid.appendChild(layer);
    });
    
    wrapper.onclick = () => onBottleClick(i);
    container.appendChild(wrapper);
    bottles.push({ element: wrapper, colors: initColors[i] });
  }
}

function onBottleClick(index) {
  const bottle = bottles[index];
  
  if(selectedIndex === null) {
    if(bottle.colors.length === 0) return;
    bottle.element.classList.add('selected');
    selectedIndex = index;
    document.getElementById('hint').textContent = '再点击目标瓶子倒水';
  } else if(selectedIndex === index) {
    bottle.element.classList.remove('selected');
    selectedIndex = null;
    document.getElementById('hint').textContent = '点击瓶子开始游戏';
  } else {
    // 倒水逻辑（简化版）
    const from = bottles[selectedIndex];
    const to = bottle;
    const color = from.colors[from.colors.length-1];
    
    if(to.colors.length >= 4) {
      document.getElementById('hint').textContent = '瓶子满了！';
      return;
    }
    
    // 移动颜色
    from.colors.pop();
    to.colors.push(color);
    
    // 更新视觉
    updateBottle(selectedIndex);
    updateBottle(index);
    
    from.element.classList.remove('selected');
    selectedIndex = null;
    document.getElementById('hint').textContent = '点击瓶子开始游戏';
  }
}

function updateBottle(index) {
  const b = bottles[index];
  const liquid = b.element.querySelector(`#liquid-${index}`);
  liquid.innerHTML = '';
  b.colors.forEach(c => {
    const l = document.createElement('div');
    l.className = 'liquid-layer';
    l.style.backgroundColor = c.hex;
    liquid.appendChild(l);
  });
  
  // 满瓶判定
  if(b.colors.length === 4 && b.colors.every(c => c.name === b.colors[0].name)) {
    b.element.classList.add('corked');
  } else {
    b.element.classList.remove('corked');
  }
}

init();
</script>
</body>
</html>
